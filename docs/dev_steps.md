# 開発STEP（MVP）
## フェーズ0：準備（仕様固め・資材整理）

GoogleフォームURL確定（本文テンプレ＋通知先確認）。

初期PDF選定（3〜5本）：テキスト抽出しやすい版を優先。

閾値/Top-k暫定決定：閾値=0.75、Top-k=3〜5。

受け入れテスト10問を作成（質問→期待振る舞い）。

セーブポイント：v0.0.1-spec_locked（仕様合意、テスト項目策定済）

## フェーズ1：オフライン索引（LangChain）

PDF取込：LangChain PDF Loader。

分割：Text Splitter（800/200）。

埋め込み：OpenAI Embeddings（少量で試行）。

索引生成：FAISS（アーティファクトをファイル出力）。

サイズ確認：デプロイ許容サイズかチェック（数十MB以内目標）。

セーブポイント：v0.1.0-index_ready（FAISS完成・サイズOK）

成果物：/artifacts/kb.faiss（例）、/artifacts/kb.pkl など。

## フェーズ2：API（Python）最小実装

API骨格：FastAPI で POST /ask。

ロード処理：起動時にFAISSを読み込み、Retriever化。

プロンプト：日本語・短文・ガード付き（不明→フォーム誘導）。

LLM呼出：OpenAI Chat（出力長を短く制限）。

閾値判定：Top-k類似度で閾値未満→fallback: true。

JSON応答：{answer, fallback} フォーマット。

簡易レート制限（無料枠保護、IP/秒）。

セーブポイント：v0.2.0-api_min（cURLで手動テスト通過）

## フェーズ3：UI（最小チャット）

単一ページ：入力欄・送信ボタン・回答表示・ローディング。

フォーム誘導：fallback: true ならGoogleフォームボタン強調。

フッター：免責・プライバシー・問い合わせリンク。

疎結合：UI→APIは/askにPOSTするだけ。

セーブポイント：v0.3.0-web_min（ブラウザから質問→回答）

## フェーズ4：MVP検証・微調整

受け入れテスト10問を実施（精度・誘導動作）。

閾値/Top-k の微調整（誤答→閾値↑、未回答多→PDF/分割調整）。

コスト確認：OpenAI利用状況（トークン量）と無料枠収まり。

軽量化：回答長上限・プロンプト短縮・Top-k最適化。

セーブポイント：v0.4.0-mvp_passed（受け入れ基準クリア）

## フェーズ5：運用セット

リリースタグ：kb-YYYYMMDD（索引版）＋app-v0.4.0。

更新手順書：PDF追加→再インデックス→再デプロイ手順をREADMEに明記。

最低限の監視：リクエスト数・fallback率の記録（簡易で可）。

バックアップ：PDF/索引アーティファクトの保管。

セーブポイント：v1.0.0-mvp-live

## 将来拡張（参考）

v0.5：フィードバック（👍👎）・簡易メトリクス。

v0.6：FAQページ自動生成（静的化）。

v0.7：出典スニペット（任意ON）。

v1.0+：LangGraph導入（再検索・検証ループ）、評価（Ragas）、管理UI（PDFアップロード）。

